globalThis.cid = "bafybeiden3ucdoj5sa7aggzq4ltqje4omezeekloxa6ognqlboaann432a";import { Buffer } from "node:buffer";
globalThis.fleek={env:{NODE_ENV: "production"}};
var j=new Set(["_nextOriginalFetch","fetch","__incrementalCache"]);function N(e){let t=globalThis.__nextOnPagesRoutesIsolation._map.get(e);if(t)return t;let s=S();return globalThis.__nextOnPagesRoutesIsolation._map.set(e,s),s}function S(){let e=new Map;return new Proxy(globalThis,{get:(t,s)=>e.has(s)?e.get(s):Reflect.get(globalThis,s),set:(t,s,a)=>j.has(s)?Reflect.set(globalThis,s,a):(e.set(s,a),!0)})}globalThis.__nextOnPagesRoutesIsolation??={_map:new Map,getProxyFor:N};var C=globalThis.fetch;function q(e){e.headers.has("user-agent")||e.headers.set("user-agent","Next.js Middleware")}var ee=Symbol.for("next-on-pages fetch patch");async function L(e){if(e.url.startsWith("blob:"))try{let s=new URL(e.url).pathname,r=`${s.replace(/.html$/,"").replace(/^\/$/,"/index")}.html`,n=`https://${globalThis.cid}.ipfs.flk-ipfs.xyz/_worker.js/__next-on-pages-dist__/assets/${s}`;console.log("builtUrl",n);let i=await fetch(n);return Promise.resolve(i)}catch(t){console.log("Failed to fetch from IPFS"),console.error(t)}return null}globalThis.fetch=async(...e)=>{let t=new Request(...e),s=await L(t);return s||(q(t),C(t))};globalThis.ASSETS={fetch:async e=>{try{let t;e instanceof URL?t=new URL(e).pathname:t=new URL(e.url).pathname;let s=t;/\.[^.]+$/.test(s)||(s=`${t.replace(/.html$/,"").replace(/^\/$/,"/index")}.html`);let a=await fetch(`https://${globalThis.cid}.ipfs.flk-ipfs.xyz${s}`);return Promise.resolve(a)}catch(t){return Promise.reject(t)}}};import("node:buffer").then(({Buffer:e})=>{globalThis.Buffer=e}).catch(()=>null);var E={collectedLocales:[]},w={version:3,routes:{none:[{src:"^(?:/((?:[^/]+?)(?:/(?:[^/]+?))*))/$",headers:{Location:"/$1"},status:308,continue:!0},{src:"^/_next/__private/trace$",dest:"/404",status:404,continue:!0},{src:"^/404/?$",status:404,continue:!0,missing:[{type:"header",key:"x-prerender-revalidate"}]},{src:"^/500$",status:500,continue:!0},{src:"^/?$",has:[{type:"header",key:"rsc"}],dest:"/index.rsc",headers:{vary:"RSC, Next-Router-State-Tree, Next-Router-Prefetch, Next-Router-Segment-Prefetch"},continue:!0,override:!0},{src:"^/((?!.+\\.rsc).+?)(?:/)?$",has:[{type:"header",key:"rsc"}],dest:"/$1.rsc",headers:{vary:"RSC, Next-Router-State-Tree, Next-Router-Prefetch, Next-Router-Segment-Prefetch"},continue:!0,override:!0}],filesystem:[{src:"^/index(\\.action|\\.rsc)$",dest:"/",continue:!0},{src:"^/_next/data/(.*)$",dest:"/_next/data/$1",check:!0},{src:"^/\\.prefetch\\.rsc$",dest:"/__index.prefetch.rsc",check:!0},{src:"^/(.+)/\\.prefetch\\.rsc$",dest:"/$1.prefetch.rsc",check:!0},{src:"^/\\.rsc$",dest:"/index.rsc",check:!0},{src:"^/(.+)/\\.rsc$",dest:"/$1.rsc",check:!0}],miss:[{src:"^/_next/static/(?:[^/]+/pages|pages|chunks|runtime|css|image|media)/.+$",status:404,check:!0,dest:"$0"}],rewrite:[{src:"^/_next/data/(.*)$",dest:"/404",status:404}],resource:[{src:"^/.*$",status:404}],hit:[{src:"^/_next/static/(?:[^/]+/pages|pages|chunks|runtime|css|image|media|i2dVNlcVTmAjcDujqObg2)/.+$",headers:{"cache-control":"public,max-age=31536000,immutable"},continue:!0,important:!0},{src:"^/index(?:/)?$",headers:{"x-matched-path":"/"},continue:!0,important:!0},{src:"^/((?!index$).*?)(?:/)?$",headers:{"x-matched-path":"/$1"},continue:!0,important:!0}],error:[{src:"^/.*$",dest:"/404",status:404},{src:"^/.*$",dest:"/500",status:500}]},images:{domains:[],sizes:[640,750,828,1080,1200,1920,2048,3840,16,32,48,64,96,128,256,384],remotePatterns:[],minimumCacheTTL:60,formats:["image/webp"],dangerouslyAllowSVG:!1,contentSecurityPolicy:"script-src 'none'; frame-src 'none'; sandbox;",contentDispositionType:"attachment"},overrides:{"404.html":{path:"404",contentType:"text/html; charset=utf-8"},"500.html":{path:"500",contentType:"text/html; charset=utf-8"},"_app.rsc.json":{path:"_app.rsc",contentType:"application/json"},"_error.rsc.json":{path:"_error.rsc",contentType:"application/json"},"_document.rsc.json":{path:"_document.rsc",contentType:"application/json"},"404.rsc.json":{path:"404.rsc",contentType:"application/json"}},framework:{version:"15.0.2"},crons:[]},_={"/404.html":{type:"override",path:"/404.html",headers:{"content-type":"text/html; charset=utf-8"}},"/404.rsc.json":{type:"override",path:"/404.rsc.json",headers:{"content-type":"application/json"}},"/500.html":{type:"override",path:"/500.html",headers:{"content-type":"text/html; charset=utf-8"}},"/_app.rsc.json":{type:"override",path:"/_app.rsc.json",headers:{"content-type":"application/json"}},"/_document.rsc.json":{type:"override",path:"/_document.rsc.json",headers:{"content-type":"application/json"}},"/_error.rsc.json":{type:"override",path:"/_error.rsc.json",headers:{"content-type":"application/json"}},"/_next/static/chunks/215-ea4a5ef50df90ca5.js":{type:"static"},"/_next/static/chunks/4bd1b696-b170db2e77860406.js":{type:"static"},"/_next/static/chunks/871.23cd2ac58f3f9482.js":{type:"static"},"/_next/static/chunks/app/_not-found/page-db268f776fca6aa4.js":{type:"static"},"/_next/static/chunks/app/layout-419bd7e5ac20edd3.js":{type:"static"},"/_next/static/chunks/app/page-5b765c7edd4e4db0.js":{type:"static"},"/_next/static/chunks/framework-56c6fb34bb17b733.js":{type:"static"},"/_next/static/chunks/main-3c10dcfcc43047a8.js":{type:"static"},"/_next/static/chunks/main-app-8b8c89b7ee8d351d.js":{type:"static"},"/_next/static/chunks/pages/_app-6a626577ffa902a4.js":{type:"static"},"/_next/static/chunks/pages/_error-1be831200e60c5c0.js":{type:"static"},"/_next/static/chunks/polyfills-42372ed130431b0a.js":{type:"static"},"/_next/static/chunks/webpack-d5c822a0bdc7cfa1.js":{type:"static"},"/_next/static/css/0a34a74814a517d0.css":{type:"static"},"/_next/static/i2dVNlcVTmAjcDujqObg2/_buildManifest.js":{type:"static"},"/_next/static/i2dVNlcVTmAjcDujqObg2/_ssgManifest.js":{type:"static"},"/_next/static/media/4473ecc91f70f139-s.p.woff":{type:"static"},"/_next/static/media/463dafcda517f24f-s.p.woff":{type:"static"},"/_next/static/release/a32b00c2f1b7e62b.wasm":{type:"static"},"/file.svg":{type:"static"},"/globe.svg":{type:"static"},"/next.svg":{type:"static"},"/vercel.svg":{type:"static"},"/window.svg":{type:"static"},"/404":{type:"override",path:"/404.html",headers:{"content-type":"text/html; charset=utf-8"}},"/500":{type:"override",path:"/500.html",headers:{"content-type":"text/html; charset=utf-8"}},"/_app.rsc":{type:"override",path:"/_app.rsc.json",headers:{"content-type":"application/json"}},"/_error.rsc":{type:"override",path:"/_error.rsc.json",headers:{"content-type":"application/json"}},"/_document.rsc":{type:"override",path:"/_document.rsc.json",headers:{"content-type":"application/json"}},"/404.rsc":{type:"override",path:"/404.rsc.json",headers:{"content-type":"application/json"}},"/favicon.ico":{type:"override",path:"/favicon.ico",headers:{"cache-control":"public, max-age=0, must-revalidate","content-type":"image/x-icon","x-next-cache-tags":"_N_T_/layout,_N_T_/favicon.ico/layout,_N_T_/favicon.ico/route,_N_T_/favicon.ico",vary:"RSC, Next-Router-State-Tree, Next-Router-Prefetch, Next-Router-Segment-Prefetch"}},"/index.html":{type:"override",path:"/index.html",headers:{"x-nextjs-stale-time":"4294967294","x-nextjs-prerender":"1","x-next-cache-tags":"_N_T_/layout,_N_T_/page,_N_T_/",vary:"RSC, Next-Router-State-Tree, Next-Router-Prefetch, Next-Router-Segment-Prefetch"}},"/index":{type:"override",path:"/index.html",headers:{"x-nextjs-stale-time":"4294967294","x-nextjs-prerender":"1","x-next-cache-tags":"_N_T_/layout,_N_T_/page,_N_T_/",vary:"RSC, Next-Router-State-Tree, Next-Router-Prefetch, Next-Router-Segment-Prefetch"}},"/":{type:"override",path:"/index.html",headers:{"x-nextjs-stale-time":"4294967294","x-nextjs-prerender":"1","x-next-cache-tags":"_N_T_/layout,_N_T_/page,_N_T_/",vary:"RSC, Next-Router-State-Tree, Next-Router-Prefetch, Next-Router-Segment-Prefetch"}},"/index.rsc":{type:"override",path:"/index.rsc",headers:{"x-nextjs-stale-time":"4294967294","x-nextjs-prerender":"1","x-next-cache-tags":"_N_T_/layout,_N_T_/page,_N_T_/",vary:"RSC, Next-Router-State-Tree, Next-Router-Prefetch, Next-Router-Segment-Prefetch","content-type":"text/x-component"}}};function U(e,t=[]){e=String(e||"").trim();let s=e,a,r="";if(/^[^a-zA-Z\\\s]/.test(e)){a=e[0];let i=e.lastIndexOf(a);r+=e.substring(i+1),e=e.substring(1,i)}let n=0;return e=A(e,i=>{if(/^\(\?[P<']/.test(i)){let c=/^\(\?P?[<']([^>']+)[>']/.exec(i);if(!c)throw new Error(`Failed to extract named captures from ${JSON.stringify(i)}`);let o=i.substring(c[0].length,i.length-1);return t&&(t[n]=c[1]),n++,`(${o})`}return i.substring(0,3)==="(?:"||n++,i}),e=e.replace(/\[:([^:]+):\]/g,(i,c)=>O[c]||i),new I(e,r,t,s,r,a)}function A(e,t){let s=0,a=0,r=!1;for(let n=0;n<e.length;n++){let i=e[n];if(r){r=!1;continue}switch(i){case"(":a===0&&(s=n),a++;break;case")":if(a>0&&(a--,a===0)){let c=n+1,o=s===0?"":e.substring(0,s),h=e.substring(c),l=String(t(e.substring(s,c)));e=o+l+h,n=s}break;case"\\":r=!0;break;default:break}}return e}var I=class extends RegExp{namedCaptures;pcrePattern;pcreFlags;delimiter;constructor(e,t,s,a,r,n){super(e,t),this.namedCaptures=s,this.pcrePattern=a,this.pcreFlags=r,this.delimiter=n}},O={alnum:"[A-Za-z0-9]",word:"[A-Za-z0-9_]",alpha:"[A-Za-z]",blank:"[ \\t]",cntrl:"[\\x00-\\x1F\\x7F]",digit:"\\d",graph:"[\\x21-\\x7E]",lower:"[a-z]",print:"[\\x20-\\x7E]",punct:"[\\]\\[!\"#$%&'()*+,./:;<=>?@\\\\^_`{|}~-]",space:"\\s",upper:"[A-Z]",xdigit:"[A-Fa-f0-9]"};function P(e,t,s){if(t==null)return{match:null,captureGroupKeys:[]};let a=s?"":"i",r=[];return{match:U(`%${e}%${a}`,r).exec(t),captureGroupKeys:r}}function g(e,t,s,{namedOnly:a}={}){return e.replace(/\$([a-zA-Z0-9_]+)/g,(r,n)=>{let i=s.indexOf(n);return a&&i===-1?r:(i===-1?t[parseInt(n,10)]:t[i+1])||""})}function v(e,{url:t,cookies:s,headers:a,routeDest:r}){switch(e.type){case"host":return{valid:t.hostname===e.value};case"header":return e.value!==void 0?y(e.value,a.get(e.key),r):{valid:a.has(e.key)};case"cookie":{let n=s[e.key];return n&&e.value!==void 0?y(e.value,n,r):{valid:n!==void 0}}case"query":return e.value!==void 0?y(e.value,t.searchParams.get(e.key),r):{valid:t.searchParams.has(e.key)}}}function y(e,t,s){let{match:a,captureGroupKeys:r}=P(e,t);return s&&a&&r.length?{valid:!!a,newRouteDest:g(s,a,r,{namedOnly:!0})}:{valid:!!a}}var F="INTERNAL_SUSPENSE_CACHE_HOSTNAME.local";function D(e){let t=new Headers(e.headers);return e.cf&&(t.set("x-vercel-ip-city",encodeURIComponent(e.cf.city)),t.set("x-vercel-ip-country",e.cf.country),t.set("x-vercel-ip-country-region",e.cf.regionCode),t.set("x-vercel-ip-latitude",e.cf.latitude),t.set("x-vercel-ip-longitude",e.cf.longitude)),t.set("x-vercel-sc-host",F),new Request(e,{headers:t})}function u(e,t,s){let a=t instanceof Headers?t.entries():Object.entries(t);for(let[r,n]of a){let i=r.toLowerCase(),c=s?.match?g(n,s.match,s.captureGroupKeys):n;i==="set-cookie"?e.append(i,c):e.set(i,c)}}function m(e){return/^https?:\/\//.test(e)}function d(e,t){for(let[s,a]of t.entries()){let r=/^nxtP(.+)$/.exec(s),n=/^nxtI(.+)$/.exec(s);r?.[1]?(e.set(s,a),e.set(r[1],a)):n?.[1]?e.set(n[1],a.replace(/(\(\.+\))+/,"")):(!e.has(s)||a&&!e.getAll(s).includes(a))&&e.append(s,a)}}function R(e,t){let s=new URL(t,e.url);return d(s.searchParams,new URL(e.url).searchParams),s.pathname=s.pathname.replace(/\/index.html$/,"/").replace(/\.html$/,""),new Request(s,e)}function x(e){return new Response(e.body,e)}function b(e){return e.split(",").map(t=>{let[s,a]=t.split(";"),r=parseFloat((a??"q=1").replace(/q *= */gi,""));return[s.trim(),isNaN(r)?1:r]}).sort((t,s)=>s[1]-t[1]).map(([t])=>t==="*"||t===""?[]:t).flat()}function k(e){switch(e){case"none":return"filesystem";case"filesystem":return"rewrite";case"rewrite":return"resource";case"resource":return"miss";default:return"miss"}}async function $(e,{request:t,assetsFetcher:s,ctx:a},{path:r,searchParams:n}){let i,c=new URL(t.url);d(c.searchParams,n);let o=new Request(c,t);try{switch(e?.type){case"function":case"middleware":{let h=e.handler;try{i=await h.default(o,a)}catch(l){let p=l;throw p.name==="TypeError"&&p.message.endsWith("default is not a function")?new Error(`An error occurred while evaluating the target edge function (${e.entrypoint})`):l}break}case"override":{i=x(await s.fetch(R(o,e.path??r))),e.headers&&u(i.headers,e.headers);break}case"static":{i=await s.fetch(R(o,r));break}default:i=new Response("Not Found",{status:404})}}catch(h){return console.error(h),new Response("Internal Server Error",{status:500})}return x(i)}function M(e,t){let s="^//?(?:",a=")/(.*)$";return!e.startsWith(s)||!e.endsWith(a)?!1:e.slice(s.length,-a.length).split("|").every(r=>t.has(r))}function z(e,{protocol:t,hostname:s,port:a,pathname:r}){return!(t&&e.protocol.replace(/:$/,"")!==t||!new RegExp(s).test(e.hostname)||a&&!new RegExp(a).test(e.port)||r&&!new RegExp(r).test(e.pathname))}function G(e,t){if(e.method!=="GET")return;let{origin:s,searchParams:a}=new URL(e.url),r=a.get("url"),n=Number.parseInt(a.get("w")??"",10),i=Number.parseInt(a.get("q")??"75",10);if(!r||Number.isNaN(n)||Number.isNaN(i)||!t?.sizes?.includes(n)||i<0||i>100)return;let c=new URL(r,s);if(c.pathname.endsWith(".svg")&&!t?.dangerouslyAllowSVG)return;let o=r.startsWith("//"),h=r.startsWith("/")&&!o;if(!h&&!t?.domains?.includes(c.hostname)&&!t?.remotePatterns?.find(f=>z(c,f)))return;let l=e.headers.get("Accept")??"",p=t?.formats?.find(f=>l.includes(f))?.replace("image/","");return{isRelative:h,imageUrl:c,options:{width:n,quality:i,format:p}}}function H(e,t,s){let a=new Headers;if(s?.contentSecurityPolicy&&a.set("Content-Security-Policy",s.contentSecurityPolicy),s?.contentDispositionType){let n=t.pathname.split("/").pop(),i=n?`${s.contentDispositionType}; filename="${n}"`:s.contentDispositionType;a.set("Content-Disposition",i)}e.headers.has("Cache-Control")||a.set("Cache-Control",`public, max-age=${s?.minimumCacheTTL??60}`);let r=x(e);return u(r.headers,a),r}async function W(e,{buildOutput:t,assetsFetcher:s,imagesConfig:a}){let r=G(e,a);if(!r)return new Response("Invalid image resizing request",{status:400});let{isRelative:n,imageUrl:i}=r,c=await(n&&i.pathname in t?s.fetch.bind(s):fetch)(i);return H(c,i,a)}function V(e){return e.indexOf("%")!==-1?decodeURIComponent(e):e}function K(e,t){try{return t(e)}catch{return e}}function Z(e,t){if(typeof e!="string")throw new TypeError("argument str must be a string");let s={},a=(t||{}).decode||V,r=0;for(;r<e.length;){let n=e.indexOf("=",r);if(n===-1)break;let i=e.indexOf(";",r);if(i===-1)i=e.length;else if(i<n){r=e.lastIndexOf(";",n-1)+1;continue}let c=e.slice(r,n).trim();if(s[c]===void 0){let o=e.slice(n+1,i).trim();o.charCodeAt(0)===34&&(o=o.slice(1,-1)),s[c]=K(o,a)}r=i+1}return s}var B=class{constructor(e,t,s,a,r){this.routes=e,this.output=t,this.reqCtx=s,this.url=new URL(s.request.url),this.cookies=Z(s.request.headers.get("cookie")||""),this.path=this.url.pathname||"/",this.headers={normal:new Headers,important:new Headers},this.searchParams=new URLSearchParams,d(this.searchParams,this.url.searchParams),this.checkPhaseCounter=0,this.middlewareInvoked=[],this.wildcardMatch=r?.find(n=>n.domain===this.url.hostname),this.locales=new Set(a.collectedLocales)}url;cookies;wildcardMatch;path;status;headers;searchParams;body;checkPhaseCounter;middlewareInvoked;locales;checkRouteMatch(e,{checkStatus:t,checkIntercept:s}){let a=P(e.src,this.path,e.caseSensitive);if(!a.match||e.methods&&!e.methods.map(n=>n.toUpperCase()).includes(this.reqCtx.request.method.toUpperCase()))return;let r={url:this.url,cookies:this.cookies,headers:this.reqCtx.request.headers,routeDest:e.dest};if(!e.has?.find(n=>{let i=v(n,r);return i.newRouteDest&&(r.routeDest=i.newRouteDest),!i.valid})&&!e.missing?.find(n=>v(n,r).valid)&&!(t&&e.status!==this.status)){if(s&&e.dest){let n=/\/(\(\.+\))+/,i=n.test(e.dest),c=n.test(this.path);if(i&&!c)return}return{routeMatch:a,routeDest:r.routeDest}}}processMiddlewareResp(e){let t="x-middleware-override-headers",s=e.headers.get(t);if(s){let i=new Set(s.split(",").map(c=>c.trim()));for(let c of i.keys()){let o=`x-middleware-request-${c}`,h=e.headers.get(o);this.reqCtx.request.headers.get(c)!==h&&(h?this.reqCtx.request.headers.set(c,h):this.reqCtx.request.headers.delete(c)),e.headers.delete(o)}e.headers.delete(t)}let a="x-middleware-rewrite",r=e.headers.get(a);if(r){let i=new URL(r,this.url),c=this.url.hostname!==i.hostname;this.path=c?`${i}`:i.pathname,d(this.searchParams,i.searchParams),e.headers.delete(a)}let n="x-middleware-next";e.headers.get(n)?e.headers.delete(n):!r&&!e.headers.has("location")?(this.body=e.body,this.status=e.status):e.headers.has("location")&&e.status>=300&&e.status<400&&(this.status=e.status),u(this.reqCtx.request.headers,e.headers),u(this.headers.normal,e.headers),this.headers.middlewareLocation=e.headers.get("location")}async runRouteMiddleware(e){if(!e)return!0;let t=e&&this.output[e];if(!t||t.type!=="middleware")return this.status=500,!1;let s=await $(t,this.reqCtx,{path:this.path,searchParams:this.searchParams,headers:this.headers,status:this.status});return this.middlewareInvoked.push(e),s.status===500?(this.status=s.status,!1):(this.processMiddlewareResp(s),!0)}applyRouteOverrides(e){!e.override||(this.status=void 0,this.headers.normal=new Headers,this.headers.important=new Headers)}applyRouteHeaders(e,t,s){!e.headers||(u(this.headers.normal,e.headers,{match:t,captureGroupKeys:s}),e.important&&u(this.headers.important,e.headers,{match:t,captureGroupKeys:s}))}applyRouteStatus(e){!e.status||(this.status=e.status)}applyRouteDest(e,t,s){if(!e.dest)return this.path;let a=this.path,r=e.dest;this.wildcardMatch&&/\$wildcard/.test(r)&&(r=r.replace(/\$wildcard/g,this.wildcardMatch.value)),this.path=g(r,t,s);let n=/\/index\.rsc$/i.test(this.path),i=/^\/(?:index)?$/i.test(a),c=/^\/__index\.prefetch\.rsc$/i.test(a);n&&!i&&!c&&(this.path=a);let o=/\.rsc$/i.test(this.path),h=/\.prefetch\.rsc$/i.test(this.path),l=this.path in this.output;o&&!h&&!l&&(this.path=this.path.replace(/\.rsc/i,""));let p=new URL(this.path,this.url);return d(this.searchParams,p.searchParams),m(this.path)||(this.path=p.pathname),a}applyLocaleRedirects(e){if(!e.locale?.redirect||!/^\^(.)*$/.test(e.src)&&e.src!==this.path||this.headers.normal.has("location"))return;let{locale:{redirect:t,cookie:s}}=e,a=s&&this.cookies[s],r=b(a??""),n=b(this.reqCtx.request.headers.get("accept-language")??""),i=[...r,...n].map(c=>t[c]).filter(Boolean)[0];if(i){!this.path.startsWith(i)&&(this.headers.normal.set("location",i),this.status=307);return}}getLocaleFriendlyRoute(e,t){return!this.locales||t!=="miss"?e:M(e.src,this.locales)?{...e,src:e.src.replace(/\/\(\.\*\)\$$/,"(?:/(.*))?$")}:e}async checkRoute(e,t){let s=this.getLocaleFriendlyRoute(t,e),{routeMatch:a,routeDest:r}=this.checkRouteMatch(s,{checkStatus:e==="error",checkIntercept:e==="rewrite"})??{},n={...s,dest:r};if(!a?.match||n.middlewarePath&&this.middlewareInvoked.includes(n.middlewarePath))return"skip";let{match:i,captureGroupKeys:c}=a;if(this.applyRouteOverrides(n),this.applyLocaleRedirects(n),!await this.runRouteMiddleware(n.middlewarePath))return"error";if(this.body!==void 0||this.headers.middlewareLocation)return"done";this.applyRouteHeaders(n,i,c),this.applyRouteStatus(n);let o=this.applyRouteDest(n,i,c);if(n.check&&!m(this.path))if(o===this.path){if(e!=="miss")return this.checkPhase(k(e));this.status=404}else if(e==="miss"){if(!(this.path in this.output)&&!(this.path.replace(/\/$/,"")in this.output))return this.checkPhase("filesystem");this.status===404&&(this.status=void 0)}else return this.checkPhase("none");return!n.continue||n.status&&n.status>=300&&n.status<=399?"done":"next"}async checkPhase(e){if(this.checkPhaseCounter++>=50)return console.error(`Routing encountered an infinite loop while checking ${this.url.pathname}`),this.status=500,"error";this.middlewareInvoked=[];let t=!0;for(let r of this.routes[e]){let n=await this.checkRoute(e,r);if(n==="error")return"error";if(n==="done"){t=!1;break}}if(e==="hit"||m(this.path)||this.headers.normal.has("location")||this.body)return"done";if(e==="none")for(let r of this.locales){let n=new RegExp(`/${r}(/.*)`),i=this.path.match(n)?.[1];if(i&&i in this.output){this.path=i;break}}let s=this.path in this.output;if(!s&&this.path.endsWith("/")){let r=this.path.replace(/\/$/,"");s=r in this.output,s&&(this.path=r)}if(e==="miss"&&!s){let r=!this.status||this.status<400;this.status=r?404:this.status}let a="miss";return s||e==="miss"||e==="error"?a="hit":t&&(a=k(e)),this.checkPhase(a)}async run(e="none"){this.checkPhaseCounter=0;let t=await this.checkPhase(e);return this.headers.normal.has("location")&&(!this.status||this.status<300||this.status>=400)&&(this.status=307),t}};async function J(e,t,s,a){let r=new B(t.routes,s,e,a,t.wildcard),n=await T(r);return X(e,n,s)}async function T(e,t="none",s=!1){return await e.run(t)==="error"||!s&&e.status&&e.status>=400?T(e,"error",!0):{path:e.path,status:e.status,headers:e.headers,searchParams:e.searchParams,body:e.body}}async function X(e,{path:t="/404",status:s,headers:a,searchParams:r,body:n},i){let c=a.normal.get("location");if(c){if(c!==a.middlewareLocation){let l=[...r.keys()].length?`?${r.toString()}`:"";a.normal.set("location",`${c??"/"}${l}`)}return new Response(null,{status:s,headers:a.normal})}let o;if(n!==void 0)o=new Response(n,{status:s});else if(m(t)){let l=new URL(t);d(l.searchParams,r),o=await fetch(l,e.request)}else o=await $(i[t],e,{path:t,status:s,headers:a,searchParams:r});let h=a.normal;return u(h,o.headers),u(h,a.important),o=new Response(o.body,{...o,status:s||o.status,headers:h}),o}async function te(e){let t=Q(e);if(new URL(t.url).pathname.startsWith("/_next/image"))return(await W(t,{buildOutput:_,assetsFetcher:globalThis.ASSETS,imagesConfig:w.images})).bytes();let s=D(t),a=await J({request:s,ctx:globalThis.CONTEXT,assetsFetcher:globalThis.ASSETS},w,_,E);return await Y(a)}function Q(e){let t=new URL(`http://0.0.0.0${e.path}`);for(let[s,a]of Object.entries(e.query??{}))t.searchParams.append(s,a);return new Request(t,{method:e.method,headers:e.headers,body:e.body})}async function Y(e){let t=await e.text(),s={};return e.headers.forEach((a,r)=>{s[r]=a}),{status:e.status,headers:s,body:t}}export{te as main};
